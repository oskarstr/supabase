services:
  platform-api:
    build:
      context: ..
      dockerfile: apps/platform-api/Dockerfile
    environment:
      PORT: "4210"
      HOST: "0.0.0.0"
      PLATFORM_API_REPO_ROOT: /workspace
    volumes:
      - platform-api-data:/app/apps/platform-api/data
      - ..:/workspace:ro
    depends_on:
      - db
    restart: unless-stopped
    container_name: platform

  studio:
    environment:
      NEXT_PUBLIC_IS_PLATFORM: "true"
      NEXT_PUBLIC_API_URL: http://host.docker.internal:4210/platform
    depends_on:
      - platform-api
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  platform-api-data:
